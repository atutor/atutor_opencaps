(function(B){B.ui=B.ui||{};B.fn.extend({dialog:function(D,E){var C=Array.prototype.slice.call(arguments,1);return this.each(function(){if(typeof D=="string"){var F=B.data(this,"ui-dialog")||B.data(B(this).parents(".ui-dialog:first").find(".ui-dialog-content")[0],"ui-dialog");F[D].apply(F,C)}else{if(!B(this).is(".ui-dialog-content")){new B.ui.dialog(this,D)}}})}});B.ui.dialog=function(E,M){this.options=M=B.extend({},B.ui.dialog.defaults,M&&M.modal?{resizable:false}:{},M);this.element=E;var L=this;B.data(this.element,"ui-dialog",this);B(E).bind("setData.dialog",function(O,N,P){M[N]=P}).bind("getData.dialog",function(O,N){return M[N]});var F=B(E).addClass("ui-dialog-content");if(!F.parent().length){F.appendTo("body")}F.wrap(document.createElement("div")).wrap(document.createElement("div"));var I=F.parent().addClass("ui-dialog-container").css({position:"relative"});var K=this.uiDialog=I.parent().hide().addClass("ui-dialog").css({position:"absolute",width:M.width,height:M.height,overflow:"hidden"});var C=F.attr("className").split(" ");B.each(C,function(N,O){if(O!="ui-dialog-content"){K.addClass(O)}});if(M.resizable&&B.fn.resizable){K.append('<div class="ui-resizable-n ui-resizable-handle"></div>').append('<div class="ui-resizable-s ui-resizable-handle"></div>').append('<div class="ui-resizable-e ui-resizable-handle"></div>').append('<div class="ui-resizable-w ui-resizable-handle"></div>').append('<div class="ui-resizable-ne ui-resizable-handle"></div>').append('<div class="ui-resizable-se ui-resizable-handle"></div>').append('<div class="ui-resizable-sw ui-resizable-handle"></div>').append('<div class="ui-resizable-nw ui-resizable-handle"></div>');K.resizable({maxWidth:M.maxWidth,maxHeight:M.maxHeight,minWidth:M.minWidth,minHeight:M.minHeight})}I.prepend('<div class="ui-dialog-titlebar"></div>');var D=B(".ui-dialog-titlebar",I);var J=(M.title)?M.title:(F.attr("title"))?F.attr("title"):"";D.append('<span class="ui-dialog-title">'+J+"</span>");D.append('<a href="#" class="ui-dialog-titlebar-close"><span>X</span></a>');this.uiDialogTitlebarClose=B(".ui-dialog-titlebar-close",D).hover(function(){B(this).addClass("ui-dialog-titlebar-close-hover")},function(){B(this).removeClass("ui-dialog-titlebar-close-hover")}).mousedown(function(N){N.stopPropagation()}).click(function(){L.close();return false}).keydown(function(N){var O=27;N.keyCode&&N.keyCode==O&&L.close()});var G=0;B.each(M.buttons,function(){G=1;return false});if(G==1){K.append('<div class="ui-dialog-buttonpane"></div>');var H=B(".ui-dialog-buttonpane",K);B.each(M.buttons,function(N,P){var O=B(document.createElement("button")).text(N).click(P);H.append(O)})}if(M.draggable&&B.fn.draggable){K.draggable({handle:".ui-dialog-titlebar",start:function(){L.activate()}})}K.mousedown(function(){L.activate()});D.click(function(){L.activate()});M.bgiframe&&B.fn.bgiframe&&K.bgiframe();this.open=function(){M.modal&&A.show(L,M.overlay);K.appendTo("body");var P=B(window),S=B(document),R=S.scrollTop(),Q=S.scrollLeft();if(M.position.constructor==Array){R+=M.position[1];Q+=M.position[0]}else{switch(M.position){case"center":R+=(P.height()/2)-(K.height()/2);Q+=(P.width()/2)-(K.width()/2);break;case"top":R+=0;Q+=(P.width()/2)-(K.width()/2);break;case"right":R+=(P.height()/2)-(K.height()/2);Q+=(P.width())-(K.width());break;case"bottom":R+=(P.height())-(K.height());Q+=(P.width()/2)-(K.width()/2);break;case"left":R+=(P.height()/2)-(K.height()/2);Q+=0;break;default:R+=(P.height()/2)-(K.height()/2);Q+=(P.width()/2)-(K.width()/2)}}R=R<S.scrollTop()?S.scrollTop():R;K.css({top:R,left:Q});K.show();L.activate();var N=null;var O={options:M};this.uiDialogTitlebarClose.focus();B(this.element).triggerHandler("dialogopen",[N,O],M.open)};this.activate=function(){var N=0;B(".ui-dialog:visible").each(function(){N=Math.max(N,parseInt(B(this).css("z-index"),10))});A.$el&&A.$el.css("z-index",++N);K.css("z-index",++N)};this.close=function(){M.modal&&A.hide();K.hide();var O=null;var N={options:M};B(this.element).triggerHandler("dialogclose",[O,N],M.close)};if(M.autoOpen){this.open()}};B.extend(B.ui.dialog,{defaults:{autoOpen:true,bgiframe:false,buttons:[],draggable:true,height:200,minHeight:100,minWidth:150,modal:false,overlay:{},position:"center",resizable:true,width:300}});var A={$el:null,events:B.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(C){return C+".ui-dialog-overlay"}).join(" "),show:function(F,E){if(this.$el){return }this.dialog=F;this.selects=this.ie6&&B("select:visible").css("visibility","hidden");var G=this.width();var C=this.height();this.$el=B("<div/>").appendTo(document.body).addClass("ui-dialog-overlay").css(B.extend({borderWidth:0,margin:0,padding:0,position:"absolute",top:0,left:0,width:G,height:C},E));B("a, :input").bind(this.events,function(){if(B(this).parents(".ui-dialog").length==0){F.uiDialogTitlebarClose.focus();return false}});B(document).bind("keydown.ui-dialog-overlay",function(H){var I=27;H.keyCode&&H.keyCode==I&&F.close()});$overlay=this.$el;function D(){$overlay.css({width:G,height:C}).css({width:A.width(),height:A.height()})}B(window).bind("resize.ui-dialog-overlay",D);F.uiDialog.is(".ui-draggable")&&F.uiDialog.data("stop.draggable",D);F.uiDialog.is(".ui-resizable")&&F.uiDialog.data("stop.resizable",D)},hide:function(){B("a, :input").add([document,window]).unbind(".ui-dialog-overlay");this.ie6&&this.selects.css("visibility","visible");this.$el=null;B(".ui-dialog-overlay").remove()},height:function(){var C;if(this.ie6&&(B(document.body).height()<B(window).height())&&!(document.documentElement.scrollTop||(this.dialog.uiDialog.offset().top+this.dialog.uiDialog.height())>B(window).height())){C=B(window).height()}else{C=B(document).height()}return C+"px"},width:function(){var C;if(this.ie6&&(B(document.body).width()<B(window).width())&&!(document.documentElement.scrollLeft||(this.dialog.uiDialog.offset().left+this.dialog.uiDialog.width())>B(window).width())){C=B(window).width()}else{C=B(document).width()}return C+"px"},ie6:B.browser.msie&&B.browser.version<7,selects:null}})(jQuery);